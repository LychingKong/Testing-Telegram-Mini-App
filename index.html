<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Telegram Shop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
          Arial, sans-serif;
        background: #f5f5f5;
        color: #333;
      }

      .hidden {
        display: none !important;
      }

      /* Header */
      .header {
        background: white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
        padding: 16px;
      }

      .header-with-back {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .back-btn {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        padding: 4px;
        display: flex;
        align-items: center;
      }

      .header h1 {
        font-size: 24px;
        font-weight: 700;
      }

      .user-welcome {
        font-size: 14px;
        color: #666;
        margin-top: 4px;
      }

      /* Products Grid */
      .products-grid {
        padding: 16px;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 16px;
        padding-bottom: 100px;
      }

      .product-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .product-content {
        padding: 16px;
      }

      .product-emoji {
        font-size: 64px;
        text-align: center;
        margin-bottom: 12px;
      }

      .product-name {
        font-weight: 600;
        font-size: 18px;
        margin-bottom: 4px;
      }

      .product-desc {
        font-size: 14px;
        color: #666;
        margin-bottom: 12px;
      }

      .product-price {
        font-size: 28px;
        font-weight: 700;
        color: #2481cc;
        margin-bottom: 12px;
      }

      .product-controls {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .quantity-controls {
        display: flex;
        align-items: center;
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
      }

      .qty-btn {
        background: white;
        border: none;
        padding: 8px 12px;
        cursor: pointer;
        font-size: 18px;
        transition: background 0.2s;
      }

      .qty-btn:hover {
        background: #f5f5f5;
      }

      .qty-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
      }

      .qty-display {
        padding: 8px 16px;
        min-width: 48px;
        text-align: center;
        font-weight: 600;
        border-left: 1px solid #ddd;
        border-right: 1px solid #ddd;
      }

      .add-to-cart-btn {
        flex: 1;
        background: #2481cc;
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
      }

      .add-to-cart-btn:hover {
        background: #1a6bb3;
      }

      .add-to-cart-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      /* Cart Footer */
      .cart-footer {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        border-top: 1px solid #ddd;
        padding: 16px;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
      }

      .cart-summary {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .cart-items-count {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
      }

      .cart-total {
        font-size: 20px;
        font-weight: 700;
        color: #2481cc;
      }

      .view-cart-btn {
        width: 100%;
        background: #2481cc;
        color: white;
        border: none;
        padding: 16px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
      }

      .view-cart-btn:hover {
        background: #1a6bb3;
      }

      /* Checkout Page */
      .checkout-container {
        padding: 16px;
        padding-bottom: 32px;
      }

      .checkout-section {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 16px;
        margin-bottom: 16px;
      }

      .section-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .cart-item {
        display: flex;
        gap: 12px;
        padding-bottom: 12px;
        margin-bottom: 12px;
        border-bottom: 1px solid #eee;
      }

      .cart-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }

      .cart-item-emoji {
        font-size: 36px;
      }

      .cart-item-details {
        flex: 1;
      }

      .cart-item-name {
        font-weight: 600;
        margin-bottom: 4px;
      }

      .cart-item-price {
        font-size: 14px;
        color: #666;
      }

      .cart-item-controls {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .cart-qty-btn {
        background: none;
        border: 1px solid #ddd;
        border-radius: 4px;
        width: 28px;
        height: 28px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .cart-qty-display {
        min-width: 32px;
        text-align: center;
        font-weight: 600;
      }

      .cart-item-right {
        text-align: right;
      }

      .cart-item-subtotal {
        font-weight: 700;
        margin-bottom: 4px;
      }

      .remove-btn {
        font-size: 12px;
        color: #e74c3c;
        background: none;
        border: none;
        cursor: pointer;
        text-decoration: underline;
      }

      .order-total {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 16px;
        border-top: 2px solid #eee;
        margin-top: 16px;
      }

      .order-total-label {
        font-size: 18px;
        font-weight: 600;
      }

      .order-total-amount {
        font-size: 28px;
        font-weight: 700;
        color: #2481cc;
      }

      /* Form */
      .form-group {
        margin-bottom: 16px;
      }

      .form-label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 8px;
        color: #555;
      }

      .form-input {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.2s;
      }

      .form-input:focus {
        outline: none;
        border-color: #2481cc;
        box-shadow: 0 0 0 3px rgba(36, 129, 204, 0.1);
      }

      textarea.form-input {
        resize: vertical;
        min-height: 80px;
        font-family: inherit;
      }

      .place-order-btn {
        width: 100%;
        background: #27ae60;
        color: white;
        border: none;
        padding: 18px;
        border-radius: 8px;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
      }

      .place-order-btn:hover {
        background: #229954;
      }

      .place-order-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      /* Success Page */
      .success-container {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 16px;
      }

      .success-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 32px;
        max-width: 400px;
        text-align: center;
      }

      .success-icon {
        font-size: 64px;
        color: #27ae60;
        margin-bottom: 16px;
      }

      .success-title {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 8px;
      }

      .success-message {
        color: #666;
        margin-bottom: 24px;
        line-height: 1.5;
      }

      .continue-shopping-btn {
        width: 100%;
        background: #2481cc;
        color: white;
        border: none;
        padding: 16px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
      }

      .continue-shopping-btn:hover {
        background: #1a6bb3;
      }

      @media (max-width: 600px) {
        .products-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!-- Products Page -->
    <div id="productsPage">
      <div class="header">
        <h1>Shop</h1>
        <div class="user-welcome" id="userWelcome"></div>
      </div>
      <div class="products-grid" id="productsGrid"></div>
      <div class="cart-footer hidden" id="cartFooter">
        <div class="cart-summary">
          <div class="cart-items-count">
            üõí <span id="cartItemCount">0</span> items
          </div>
          <div class="cart-total" id="cartTotal">$0.00</div>
        </div>
        <button class="view-cart-btn" onclick="goToCheckout()">
          View Cart & Checkout
        </button>
      </div>
    </div>

    <!-- Checkout Page -->
    <div id="checkoutPage" class="hidden">
      <div class="header">
        <div class="header-with-back">
          <button class="back-btn" onclick="goToProducts()">‚Üê</button>
          <h1>Checkout</h1>
        </div>
      </div>
      <div class="checkout-container">
        <div class="checkout-section">
          <div class="section-title">üì¶ Order Summary</div>
          <div id="checkoutItems"></div>
          <div class="order-total">
            <span class="order-total-label">Total:</span>
            <span class="order-total-amount" id="checkoutTotal">$0.00</span>
          </div>
        </div>

        <div class="checkout-section">
          <div class="section-title">Shipping Information</div>
          <form id="orderForm">
            <div class="form-group">
              <label class="form-label">üë§ Full Name *</label>
              <input
                type="text"
                class="form-input"
                id="customerName"
                placeholder="John Doe"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label">üìû Phone Number *</label>
              <input
                type="tel"
                class="form-input"
                id="customerPhone"
                placeholder="+1234567890"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label">üìç Delivery Address *</label>
              <textarea
                class="form-input"
                id="customerAddress"
                placeholder="123 Main St, City, Country"
                required
              ></textarea>
            </div>
          </form>
        </div>

        <button
          class="place-order-btn"
          id="placeOrderBtn"
          onclick="placeOrder()"
        >
          Place Order - $0.00
        </button>
      </div>
    </div>

    <!-- Success Page -->
    <div id="successPage" class="hidden">
      <div class="success-container">
        <div class="success-card">
          <div class="success-icon">‚úì</div>
          <h1 class="success-title">Order Placed Successfully!</h1>
          <p class="success-message">
            Thank you for your order. We'll contact you soon to confirm delivery
            details.
          </p>
          <button class="continue-shopping-btn" onclick="goToProducts()">
            Continue Shopping
          </button>
        </div>
      </div>
    </div>

    <script>
      // Configuration
      const GOOGLE_SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbya5AQd1Bur_3frdadyjqdB-YvP8Mynl-TYlbV0ymVOk8Xso0ZoEQfdYKIzNsameulSyg/exec";

      // Product catalog
      const PRODUCTS = [
        {
          id: 1,
          name: "Premium Headphones",
          price: 79.99,
          image: "üéß",
          description: "High-quality wireless headphones",
        },
        {
          id: 2,
          name: "Smart Watch",
          price: 199.99,
          image: "‚åö",
          description: "Fitness tracking smartwatch",
        },
        {
          id: 3,
          name: "Wireless Earbuds",
          price: 49.99,
          image: "üéµ",
          description: "Compact Bluetooth earbuds",
        },
        {
          id: 4,
          name: "Phone Case",
          price: 19.99,
          image: "üì±",
          description: "Protective phone case",
        },
        {
          id: 5,
          name: "Portable Charger",
          price: 34.99,
          image: "üîã",
          description: "10000mAh power bank",
        },
        {
          id: 6,
          name: "Bluetooth Speaker",
          price: 59.99,
          image: "üîä",
          description: "Waterproof portable speaker",
        },
      ];

      // State
      let cart = {};
      let productQuantities = {};
      let telegramUser = null;

      // Initialize Telegram WebApp
      if (window.Telegram && window.Telegram.WebApp) {
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
          telegramUser = tg.initDataUnsafe.user;
          document.getElementById("userWelcome").textContent =
            `Welcome, ${telegramUser.first_name}!`;
        }

        document.body.style.backgroundColor = tg.backgroundColor || "#f5f5f5";
      }

      // Initialize app
      function init() {
        renderProducts();
        updateCartFooter();
      }

      // Render products
      function renderProducts() {
        const grid = document.getElementById("productsGrid");
        grid.innerHTML = PRODUCTS.map(
          (product) => `
        <div class="product-card">
          <div class="product-content">
            <div class="product-emoji">${product.image}</div>
            <div class="product-name">${product.name}</div>
            <div class="product-desc">${product.description}</div>
            <div class="product-price">$${product.price.toFixed(2)}</div>
            <div class="product-controls">
              <div class="quantity-controls">
                <button class="qty-btn" onclick="updateProductQuantity(${product.id}, -1)" 
                  ${!productQuantities[product.id] ? "disabled" : ""}>‚àí</button>
                <div class="qty-display" id="qty-${product.id}">${productQuantities[product.id] || 0}</div>
                <button class="qty-btn" onclick="updateProductQuantity(${product.id}, 1)">+</button>
              </div>
              <button class="add-to-cart-btn" onclick="addToCart(${product.id})"
                ${!productQuantities[product.id] ? "disabled" : ""}>Add to Cart</button>
            </div>
          </div>
        </div>
      `,
        ).join("");
      }

      // Update product quantity
      function updateProductQuantity(productId, delta) {
        productQuantities[productId] = Math.max(
          0,
          (productQuantities[productId] || 0) + delta,
        );
        document.getElementById(`qty-${productId}`).textContent =
          productQuantities[productId];

        const card = document
          .getElementById(`qty-${productId}`)
          .closest(".product-card");
        const minusBtn = card.querySelector(".qty-btn:first-child");
        const addBtn = card.querySelector(".add-to-cart-btn");

        minusBtn.disabled = !productQuantities[productId];
        addBtn.disabled = !productQuantities[productId];
      }

      // Add to cart
      function addToCart(productId) {
        const qty = productQuantities[productId] || 0;
        if (qty > 0) {
          cart[productId] = (cart[productId] || 0) + qty;
          productQuantities[productId] = 0;
          renderProducts();
          updateCartFooter();

          if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.HapticFeedback.impactOccurred("medium");
          }
        }
      }

      // Update cart footer
      function updateCartFooter() {
        const itemCount = Object.values(cart).reduce(
          (sum, qty) => sum + qty,
          0,
        );
        const total = Object.entries(cart).reduce((sum, [id, qty]) => {
          const product = PRODUCTS.find((p) => p.id === parseInt(id));
          return sum + product.price * qty;
        }, 0);

        document.getElementById("cartItemCount").textContent = itemCount;
        document.getElementById("cartTotal").textContent =
          `$${total.toFixed(2)}`;

        if (itemCount > 0) {
          document.getElementById("cartFooter").classList.remove("hidden");
        } else {
          document.getElementById("cartFooter").classList.add("hidden");
        }
      }

      // Navigation
      function goToCheckout() {
        document.getElementById("productsPage").classList.add("hidden");
        document.getElementById("checkoutPage").classList.remove("hidden");
        renderCheckout();
      }

      function goToProducts() {
        document.getElementById("checkoutPage").classList.add("hidden");
        document.getElementById("successPage").classList.add("hidden");
        document.getElementById("productsPage").classList.remove("hidden");
      }

      // Render checkout
      function renderCheckout() {
        const itemsContainer = document.getElementById("checkoutItems");
        const total = Object.entries(cart).reduce((sum, [id, qty]) => {
          const product = PRODUCTS.find((p) => p.id === parseInt(id));
          return sum + product.price * qty;
        }, 0);

        itemsContainer.innerHTML = Object.entries(cart)
          .map(([id, qty]) => {
            const product = PRODUCTS.find((p) => p.id === parseInt(id));
            return `
          <div class="cart-item">
            <div class="cart-item-emoji">${product.image}</div>
            <div class="cart-item-details">
              <div class="cart-item-name">${product.name}</div>
              <div class="cart-item-price">$${product.price.toFixed(2)} each</div>
            </div>
            <div class="cart-item-controls">
              <button class="cart-qty-btn" onclick="updateCartQuantity(${product.id}, -1)">‚àí</button>
              <span class="cart-qty-display">${qty}</span>
              <button class="cart-qty-btn" onclick="updateCartQuantity(${product.id}, 1)">+</button>
            </div>
            <div class="cart-item-right">
              <div class="cart-item-subtotal">$${(product.price * qty).toFixed(2)}</div>
              <button class="remove-btn" onclick="removeFromCart(${product.id})">Remove</button>
            </div>
          </div>
        `;
          })
          .join("");

        document.getElementById("checkoutTotal").textContent =
          `$${total.toFixed(2)}`;
        document.getElementById("placeOrderBtn").textContent =
          `Place Order - $${total.toFixed(2)}`;
      }

      // Update cart quantity
      function updateCartQuantity(productId, delta) {
        cart[productId] = (cart[productId] || 0) + delta;
        if (cart[productId] <= 0) {
          delete cart[productId];
        }
        renderCheckout();
        updateCartFooter();
      }

      // Remove from cart
      function removeFromCart(productId) {
        delete cart[productId];
        renderCheckout();
        updateCartFooter();

        if (Object.keys(cart).length === 0) {
          goToProducts();
        }
      }

      // Place order
      async function placeOrder() {
        const name = document.getElementById("customerName").value.trim();
        const phone = document.getElementById("customerPhone").value.trim();
        const address = document.getElementById("customerAddress").value.trim();

        if (!name || !phone || !address) {
          alert("Please fill in all required fields");
          return;
        }

        const btn = document.getElementById("placeOrderBtn");
        btn.disabled = true;
        btn.textContent = "Processing...";

        const total = Object.entries(cart).reduce((sum, [id, qty]) => {
          const product = PRODUCTS.find((p) => p.id === parseInt(id));
          return sum + product.price * qty;
        }, 0);

        const orderData = {
          orderId: `ORD-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
          customer: { name, phone, address },
          items: Object.entries(cart).map(([id, qty]) => {
            const product = PRODUCTS.find((p) => p.id === parseInt(id));
            return {
              productId: id,
              productName: product.name,
              quantity: qty,
              price: product.price,
              subtotal: product.price * qty,
            };
          }),
          total: total,
          telegramUser: telegramUser
            ? {
                id: telegramUser.id,
                username: telegramUser.username || "",
                firstName: telegramUser.first_name || "",
                lastName: telegramUser.last_name || "",
              }
            : null,
          timestamp: new Date().toISOString(),
        };

        try {
          await fetch(GOOGLE_SCRIPT_URL, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(orderData),
          });

          cart = {};
          document.getElementById("customerName").value = "";
          document.getElementById("customerPhone").value = "";
          document.getElementById("customerAddress").value = "";

          document.getElementById("checkoutPage").classList.add("hidden");
          document.getElementById("successPage").classList.remove("hidden");

          updateCartFooter();

          if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.HapticFeedback.notificationOccurred(
              "success",
            );
          }
        } catch (error) {
          console.error("Order error:", error);
          alert("Failed to submit order. Please try again.");

          if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.HapticFeedback.notificationOccurred("error");
          }
        } finally {
          btn.disabled = false;
          btn.textContent = `Place Order - $${total.toFixed(2)}`;
        }
      }

      // Initialize on load
      init();
    </script>
  </body>
</html>
